# Rule 1 - Prefer Exceptions

Sample codes - return error codes from function

```ts

if (deletePage(page) == E_OK) {
    if (registry.deleteReference(page.name) == E_OK) {
        if (configKeys.deleteKey(page.name.makeKey()) == E_OK){
            logger.log("page deleted");
        } else {
            logger.log("configKey not deleted");
        }
    } else {
        logger.log("deleteReference from registry failed");
    }
} else {
    logger.log("delete failed");
    return E_ERROR;
}

```

<!--
1. è¿˜æ˜¯æŒ‰ç…§å’Œä»¥å‰ä¸€æ ·çš„æ–¹å¼ï¼Œä¸»è¦æ˜¯å…ˆåŽŸæ±åŽŸå‘³çš„è®²è§£ä¹¦ä¸­çš„å†…å®¹ï¼Œå†åŠ ä¸Šä¸€ç‚¹ä¸ªäººçš„ç†è§£ç»™ç»™å¤§å®¶ã€‚
2. è¿™æ˜¯ä¹¦ä¸­çš„æ ·ä¾‹ä»£ç ï¼Œ ç»™å¤§å®¶20ç§’ä¸­çš„æ—¶é—´ï¼Œå¤§å®¶å¯ä»¥çœ‹ä¸‹è¿™æ®µä»£ç æœ‰ä»€ä¹ˆæ ·çš„é—®é¢˜ã€‚
3. ç®€å•è¿‡ä¸€ä¸‹ä»£ç å†…å®¹ - é‡ç‚¹æ˜¯æ¯ä¸ªæ–¹æ³•çš„è°ƒç”¨å­˜åœ¨ä¾èµ–å…³ç³»ï¼Œä¸Šä¸€ä¸ªæˆåŠŸåŽï¼Œæ‰èƒ½æ‰§è¡Œä¸‹ä¸€ä¸ªã€‚
-->

---

# What problems to return error codes?

1. Deeply nested structures
2. Dependency Magnet

<!--
1. ä¸€æ˜¯åµŒå¥—å¤ªæ·±äº†ï¼Œ æœ€å¤šæ˜¯æœ‰5å±‚ï¼Œåœ¨æˆ‘ä»¬ç¬¬ä¸€èŠ‚è¯¾ä¸­ï¼Œæœ€å¯»smallçš„åŽŸåˆ™ï¼Œæœ€å¥½ä¸è¦è¶…è¿‡2ä¸¤å±‚ã€‚
2. äºŒæ˜¯ï¼Œä¹¦ä¸­ç»™å‡ºäº†ä¸€ä¸ªè¯è¯­ï¼Œå«ä¾èµ–ç£é“ã€‚ åœ¨ä¸Šé¢çš„æ ·ä¾‹ä»£ç ä¸­ï¼ŒE_OK è¿™æ ·çš„çŠ¶æ€ç ä¸€èˆ¬éƒ½ä¼šå®šä¹‰ä¸­ä¸€ä¸ªæžšä¸¾ç±»ä¸­ï¼Œå¯ä»¥ä¼šæœ‰å¾ˆå¤šå…¶ä»–çš„æ–¹æ³•æ¥ä½¿ç”¨å®ƒä»¬ï¼Œ å½“æˆ‘ä»¬éœ€è¦æ›´æ–°å®ƒçš„åå­—çš„æ—¶å€™ï¼Œæ‰€æœ‰è°ƒç”¨çš„åœ°æ–¹éƒ½ä¼šå—å½±å“ã€‚ä¸€èˆ¬ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šæ–°å¢žä¸€ä¸ªcodeï¼Œå³ä½¿å¯èƒ½å·²ç»å­˜åœ¨ä¸€ä¸ªç±»ä¼¼çš„å­˜åœ¨ã€‚è¿™æ ·æ…¢æ…¢ä¹Ÿå°±æ¼”å˜æˆäº†ä¸€äº›åƒå¥‡ç™¾æ€ªçš„å†—ä½™ä»£ç çš„å­˜åœ¨ï¼Œå¹¶ä¸”è¿˜è°éƒ½ä¸èƒ½è½»æ˜“çš„åŽ»è§¦ç¢°å®ƒä»¬ã€‚
-->

---

# Use exceptions instead of returned error codes

```ts
try {
    deletePage(page);
    registry.deleteReference(page.name);
    configKeys.deleteKey(page.name.makeKey());
} 
catch (Exception e) {
    logger.log(e.getMessage());
}
```

<!--
1. é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œä¹¦ä¸­ç»™å‡ºäº†ä¸€ç§æŽ¨èçš„è§£å†³æ–¹æ¡ˆ - å°±æ˜¯ä½¿ç”¨ä¸€ä¸ªtry/catchå—æ¥åŒ…æ‹¬èµ·æ¥è¿™ä¸‰ä¸ªæ–¹æ³•çš„è°ƒç”¨ï¼Œæ¥ä¸€èµ·éƒ¨ç½²è¿™äº›æ–¹æ³•æŠ›å‡ºçš„å¼‚å¸¸ã€‚ è¿™æ ·æ—¢å‡å°‘äº†ä»£ç å±‚çº§çš„åµŒå¥—ï¼Œåˆå®Œç¾Žçš„å®žçŽ°äº†ä»»ä½•ä¸€ä¸ªæ–¹æ³•æ‰§è¡Œå¤±è´¥éƒ½ä¼šç»ˆæ­¢æ•´ä¸ªæµç¨‹ã€‚
-->

---

# Problemï¼Ÿ

[LanguageAssignmentManager](https://gitlab.com/kingland-projects/indy/projects/independence/-/blob/master/Independence/src/com/kingland/independence/languageassignment/LanguageAssignmentManager.java?ref_type=heads#L1152)


<!--
1. åˆåˆ°äº†æ€è€ƒæ—¶åˆ»ï¼Œéš¾é“ä»…ä»…æ˜¯ä½¿ç”¨ä¸€ä¸ªtry/catchå—ï¼Œå°±æ²¡æœ‰ä»»ä½•é—®é¢˜äº†å—ï¼Ÿ
2. å¤§å®¶çœ‹ä¸€ä¸‹æˆ‘éšä¾¿ä»Žç³»ç»Ÿä¸­æ‰¾åˆ°çš„ä¸€æ®µä»£ç å“ˆï¼Œå¤§å®¶çœ‹çœ‹è¿™ä¸ªæ–¹æ³•ä¸­æ€»å…±æœ‰å¤šå°‘ä¸ªtry/catchå—ï¼Œè¿™æ®µé˜…è¯»èµ·æ¥é‚£æ˜¯ç›¸å½“è´¹åŠ²çš„ã€‚
3. è¿™è¿˜åªæ˜¯åœ¨ä¸€ä¸ªæ–¹æ³•ä¸­ï¼Œ å¦‚æžœæ–¹æ³•çš„è°ƒç”¨å±‚çº§å¾ˆæ·±ï¼Œæ¯ä¸€å±‚çº§çš„æ–¹æ³•éƒ½æœ‰è¿™æ ·çš„try/catchå—ï¼Œé‚£ç®€ç›´å°±æ˜¯ç¾éš¾ã€‚
3. ç”±æ­¤å¯è§ï¼Œå¦‚æžœåªæ˜¯è‚†æ— å¿Œæƒ®æ·»åŠ try/catchå—ï¼Œè€Œæ²¡æœ‰éµå¾ªä¸€å®šçš„è§„åˆ™çš„è¯ï¼Œä¹Ÿä¼šå¸¦æ¥å¾ˆå¤§çš„é˜…è¯»è´Ÿæ‹…ã€‚

-->

---

# How to extract try/catch blocks?

1. DO NOT add try/catch to every level of function
2. Error handling is one thing

<!--
1. é‚£å¦‚ä½•è§£å†³è¿™æ ·çš„é—®é¢˜ï¼Œ æˆ‘æ€»ç»“å½’çº³ä¹¦ä¸­çš„è§‚ç‚¹ä¸ºä¸¤ç‚¹ã€‚
2. ä¸€ä¸è¦åœ¨æ¯ä¸€ä¸ªå±‚çº§çš„æ–¹æ³•ä¸­ï¼Œ éƒ½æ·»åŠ try/catch å—ã€‚
3. äºŒæ˜¯é”™è¯¯å¤„ç†å°±åº”è¯¥è¢«å½“ä½œå·²ç»æ—¶é—´å¤„ç†ã€‚æˆ‘ä»¬ä¹‹å‰è®²çš„è§„åˆ™ï¼Œä¸€ä¸ªå‡½æ•°åº”è¯¥åªåšä¸€ä»¶äº‹æƒ…(do one thing)ï¼Œ åœ¨è¿™ä¸ªé”™è¯¯å¤„ç†çš„å‡½æ•°ä¸­åŒæ ·é€‚ç”¨ã€‚
4. é‚£æˆ‘ä»¬åˆ†åˆ«æ¥çœ‹ä¸€ä¸‹è¿™ä¸¤æ¡è§„åˆ™ã€‚

5. éœ€è¦å¼ºè°ƒçš„ä¸€ç‚¹æ˜¯ï¼Œè¿™èŠ‚è¯¾ä¸­çš„å†…å®¹å…³äºŽtry/catchæ•èŽ·å¼‚å¸¸ï¼Œéƒ½æ˜¯åœ¨å‰å‡ è¯¾å†…å®¹åŸºäºŽå‡½æ•°å±‚çº§åˆ’åˆ†çš„åŸºç¡€ä¸Šï¼Œå¦‚ä½•è§„åˆ’å¥½try/catchå¢žåŠ æ¥å¯è¯»æ€§ï¼Œå¹¶ä¸æ˜¯å…³äºŽcheckedå’Œuncheckedå¼‚å¸¸çš„è®¨è®ºï¼Œå®ƒä»¬æ˜¯è¿™æœ¬ä¹¦ä¸­åŽç»­çš„å†…å®¹ã€‚ å…¶å®žå‰å‡ å¹´Bè€å¸ˆå’ŒNateå”ï¼Œè¿˜æœ‰Ræ€» ä¹Ÿéƒ½æœ‰è¿‡lunchlearnï¼Œ åŽç»­æˆ‘ä»¬ä¹Ÿä¼šå†ä¸€èµ·å›žé¡¾é‚£éƒ¨åˆ†å†…å®¹ã€‚
-->

---

# DO NOT add try/catch to every level of function

<img src="/images/exceptionlevel.png" class="rounded shadow" />


<!--
1. ä¸ºäº†æ–¹ä¾¿å¤§å®¶ç†è§£ï¼Œ æˆ‘ç›´æŽ¥å°†ä¹¦ä¸­çš„ä»£ç ï¼Œä»¥å›¾å½¢åˆ’çš„æ–¹å¼å±•ç¤ºå‡ºæ¥ã€‚
2. è¿™ä¸ªè§„åˆ™è¯´çš„ä¹Ÿå°±æ˜¯ï¼Œä¸€å®šè¦æœ€ä¸Šçš„å±‚çº§ç»Ÿä¸€åœ°åŽ»æ•èŽ·å’Œå¤„ç†ä¸€æ ·ï¼Œè€Œä¸æ˜¯åœ¨ç¬¬ä¸‰å’Œç¬¬äºŒå±‚çº§ï¼Œåˆ†åˆ«åŽ»åštry/catch æ“ä½œã€‚

-->
---

# DO NOT add try/catch to every level of function

```ts
public void delete(Page page) {
	 try {
		deletePageAndAllReferences(page);
	 }catch (Exception e) {
		logError(e);
	 }
 }

private void deletePageAndAllReferences(Page page) throws Exception {
	deletePage(page);
	registry.deleteReference(page.name);
	configKeys.deleteKey(page.name.makeKey());
}

private void logError(Exception e) {
	logger.log(e.getMessage());
}
```

<!--
1. è¿™æ˜¯ä¹¦ä¸­æ ·ä¾‹çš„ä»£ç ã€‚

-->
---

# Problem?

<v-click>

How do we know what level to go up to?

</v-click>

<!--
1. ç»™å‡ ç§’ä¸­æé—®ã€‚
2. ä½†æ˜¯æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œ ä¹¦ä¸­æ²¡æœ‰æ˜Žç¡®è¯´æ˜Žï¼Œé‚£åˆ°åº•å‘ä¸ŠæŠ½å–åˆ°å“ªä¸€å±‚çº§åˆé€‚ï¼Ÿ
3. çœ‹ä¹¦ä¸­çš„ä¾‹å­ï¼Œæˆ‘ä»¬ä¼šç†æ‰€å½“ç„¶çš„è®¤ä¸ºï¼Œå—¯ï¼Œ å®ƒå°±åº”è¯¥æ˜¯è¿™ä¸ªæ ·å­ï¼Œå°±åº”è¯¥æ˜¯åœ¨è¿™ä¸€å±‚ã€‚é‚£æ¢æˆæˆ‘ä»¬çš„å®žé™…ä¸šåŠ¡ä»£ç å¯èƒ½å°±ä¸æ¸…æ¥šå®ƒåº”è¯¥åœ¨é‚£ä¸€å±‚çº§æ·»åŠ ï¼Œæˆ–è€…è¯´æˆ‘ä»¬æœ‰ä»€ä¹ˆè¿›ä¸€æ­¥çš„è§„åˆ™åŽ»éµå¾ªä¹ˆã€‚
4. æ³¨æ„äº†ï¼Œä¹¦ä¸­å¹¶æ²¡æœ‰ç»™å‡ºç‰¹åˆ«æ¸…æ™°çš„è¯´æ³•ï¼Œä»¥ä¸‹æ˜¯æˆ‘ä¸ªäººçš„æƒ³æ³•ï¼Œä»…ä¾›å‚è€ƒï¼ï¼
-->

---

# DO NOT add try/cacth to every level of function

### Personal View
https://frankie-talks-thinking.netlify.app/23

- Any dependencies between function execution order?

> ðŸ‘‰ Yes - DO NOT add tryc/acth to every level of function

> ðŸ‘‰ No - Add try/catch in function itself

<!--
1. æˆ‘è®¤ä¸ºæˆ‘ä»¬åº”è¯¥å…³æ³¨çš„ä¸€ä¸ªé‡ç‚¹å°±æ˜¯ï¼ŒåŒä¸€å±‚çº§çš„æ–¹æ³•ä¸­æ˜¯å¦æœ‰æ‰§è¡Œçš„ä¾èµ–å…³ç³»ï¼Œå°±æ˜¯åŽä¸€ä¸ªæ–¹æ³•çš„è°ƒç”¨è¦ä¾èµ–äºŽå‰ä¸€ä¸ªæ–¹æ³•çš„æ‰§è¡Œç»“æžœï¼Œå¦‚æžœå‰ä¸€ä¸ªæ‰§è¡ŒæˆåŠŸå®ƒç»§ç»­æ‰§è¡Œï¼Œå¦åˆ™æµç¨‹ç»ˆæ­¢ã€‚
2. æ¸…æ¥šè¿™ä¸€ç‚¹åŽï¼Œ æˆ‘ä»¬åº”è¯¥éµå¾ªçš„è§„åˆ™æ˜¯ï¼Œå¦‚æžœæœ‰ä¾èµ–ï¼Œä¸è¦åœ¨å½“å‰å±‚çº§çš„æ–¹æ³•ä¸­æ·»åŠ try/catchï¼Œåº”è¯¥ç»§ç»­å‘ä¸Šå¯»æ‰¾ï¼Œç›´åˆ°ï¼ŒåŒä¸€å±‚çº§çš„å¤šä¸ªæ–¹æ³•æ²¡æœ‰ä¾èµ–ï¼Œé‚£try/catchå—åº”è¯¥æ·»åŠ åˆ°å„è‡ªæ–¹æ³•ä¸­ã€‚
3. å†ä¸€èµ·çœ‹ä¸€ä¸‹ï¼Œæˆ‘ä¹‹å‰çš„åˆ†äº«ä¸­å…³äºŽTBçš„å±‚çº§å›¾ï¼Œå‡è®¾æ—¥æ–™å’Œç«é”…è¿™ä¸€å±‚çº§æœ‰ä¾èµ–ï¼Œé‚£å°±ä¸åº”è¯¥åœ¨å®ƒä»¬æ·»åŠ try/catchï¼Œé‚£å°±åº”è¯¥å‘ä¸Šå¯»æ‰¾ï¼Œå‡è®¾ï¼Œé¤é¥®å’Œæ¸¸æˆä¹Ÿæœ‰ä¾èµ–ï¼Œé‚£å°±åº”è¯¥ç»§ç»­å‘ä¸Šå¯»æ‰¾ï¼Œè¿™æ—¶å‡è®¾å¨±ä¹é¡¹ç›®é€‰æ‹©å’Œå®¶å±žé¤é¥®æ²¡æœ‰ä¾èµ–ï¼Œ é‚£try/catchå°±åº”è¯¥æ·»åŠ åˆ°å¨±ä¹é¡¹ç›®é€‰æ‹©è¿™ä¸€å±‚ï¼Œå¦åˆ™å°±åº”è¯¥ç»§ç»­å‘ä¸Šç›´åˆ°æœ€é¡¶å±‚ã€‚
4. å®žé™…çš„ä¸šåŠ¡ä»£ç ï¼Œè‚¯å®šæ˜¯è¿™ç§ä¾èµ–å…³ç³»å’Œæ²¡æœ‰ä¾èµ–å…³ç³»æ–¹æ³•æ··åˆåœ¨ä¸€èµ·çš„æƒ…å†µï¼Œå¤§å®¶å¯ä»¥è¯•ç€ç”¨æˆ‘è¿™ä¸ªæ–¹æ³•ã€‚ å‡ºé—®é¢˜äº†ï¼Œä¸è¦æ‰¾æˆ‘å“ˆã€‚


-->

---

### Multiple try/catch
```ts
public void prepareTeamBuilding() {
	try {
		chooseActivities();
	 }catch (ExceptionA e) {
		logError(e);
	 }

    try {
		checkFamilyMembers();
	 }catch (ExceptionB e) {
		logError(e);
	 }
 }
```
<!--
1. å¯èƒ½ä¼šæœ‰å°ä¼™ä¼´ï¼Œè¡¨ç¤ºä¸è®¤åŒï¼Œ æ—¢ç„¶è¿™ä¸¤ä¸ªæ–¹æ³•æ²¡æœ‰ä¾èµ–ï¼Œä¸ºä»€ä¹ˆä¸€å®šè¦å°†try/catchå—æ·»åŠ åˆ°å„è‡ªçš„æ–¹æ³•ä¸­ï¼Œå‘è¿™æ ·å†™åˆ°ä¸€ä¸ªæ–¹æ³•ä¸­ï¼Œåˆ†åˆ«åštry/catch æœ‰ä»€ä¹ˆé—®é¢˜å‘¢ã€‚
2. é—®é¢˜å°±æ˜¯å¢žåŠ äº†é˜…è¯»è´Ÿæ‹…ï¼Œ è¿åä¸‹é¢çš„è§„åˆ™ï¼Œ error handing is one thing
-->
---

# Error handling is one thing

1. if the keyword
try exists in a function, it should be the very first word in the function and that there
should be nothing after the catch/finally blocks.

2. Functions should do one thing. Error handing is one thing. Thus, a function that handles
errors should do nothing else.

```ts
public void delete(Page page) {
	 try {
		deletePageAndAllReferences(page);
	 }catch (Exception e) {
		logError(e);
	 }
 }
```

<!--
1. å‰é¢æåˆ°äº†ï¼Œè¦éµå¾ª do one thingçš„åŽŸåˆ™ï¼Œ é”™è¯¯å¤„ç†ä¹Ÿåº”è¯¥è¢«å½“ä½œä¸€ä»¶äº‹æƒ…æ¥å‡ºæ¥ã€‚ è¿™ç§å†™æ³•å°±æ˜¯ä¸€ä¸ªå‡½æ•°ä¸­ï¼Œåœ¨å¤„ç†ä¸¤ä»¶äº‹æƒ…ã€‚
2. try/catch å—å‰ä¸è¦æœ‰ä»£ç ï¼Œ æ˜¯æŒ‡ä¸è¦æœ‰ä¸šåŠ¡æµç¨‹çš„ä»£ç å‡è½»é˜…è¯»è´Ÿæ‹…ã€‚ä½†æ˜¯æ­£å¸¸çš„å˜é‡å£°æ˜Žç­‰æ˜¯æ­£å¸¸çš„ã€‚
-->
